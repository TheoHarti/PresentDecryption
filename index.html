<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Weihnachtsr√§tsel 2024</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
    }
    header {
      background-color: #b22222;
      color: #fff;
      padding: 10px;
      text-align: center;
    }
    nav {
      background-color: #f2f2f2;
      padding: 10px;
      text-align: center;
    }
    nav a {
      margin: 0 10px;
      text-decoration: none;
      color: #000;
      font-size: 1.2rem;
      font-weight: bold;
    }
    .container {
      padding: 20px;
      display: none; /* alle erst mal unsichtbar */
    }
    .active {
      display: block; /* nur aktive Seite wird angezeigt */
    }
    .center {
      text-align: center;
    }
    .code-input {
      width: 60px;
      padding: 5px;
      text-align: center;
      margin: 5px;
      font-size: 1.1em;
    }
    .btn {
      padding: 8px 16px;
      margin: 10px;
      cursor: pointer;
      background-color: #b22222;
      color: #fff;
      border: none;
      font-size: 1em;
    }
    #decryptedResult {
      margin-top: 10px;
      font-weight: bold;
    }
    /* Anpassung f√ºr kleine Bildschirme */
    @media (max-width: 600px) {
      nav a {
        display: block;
        margin: 5px 0;
      }
    }
  </style>
</head>
<body>

<header>
  <h1>Weihnachtsr√§tsel 2024</h1>
</header>

<nav>
  <a href="#" onclick="showPage('welcome')">Start</a>
  <a href="#" onclick="showPage('page2')">Sudoku</a>
  <a href="#" onclick="showPage('page3')">Kreuzwortr√§tsel</a>
  <a href="#" onclick="showPage('page4')">Hardest Game</a>
  <a href="#" onclick="showPage('page5')">H√∂rspiel</a>
  <a href="#" onclick="showPage('decoder')">Decoder</a>
</nav>

<!-- Seite 1: Willkommen/Regeln -->
<div id="welcome" class="container active">
  <h2>Willkommen zum Weihnachtsr√§tsel!</h2>
  <p>Hallo liebe Familie!<br>
    Auf diesen Seiten findet ihr vier R√§tsel. √úber die Navigationsleiste oben k√∂nnt ihr hin und her wechseln.
    Jedes R√§tsel hat einen 4-stelligen Zahlencode als L√∂sung. Also diese immer genau notieren. 
    Am Schluss auf der letzen Seite gebt ihr die vier 4-stelligen Codes in den Decoder ein, plus den verschl√ºsselten Namen auf den Geschenken, 
    und dr√ºckt auf "Entschl√ºsseln". Wenn alles passt, seht ihr den richtigen Klartext!</p>
  <p><strong>Regeln:</strong></p>
  <ul>
    <li>R√§tsel in beliebiger Reihenfolge l√∂sen</li>
    <li>Jeder Code = 4 Ziffern</li>
    <li>Decoder nutzen, 4 Codes + verschl√ºsselter Name</li>
    <li>Viel Spa√ü und frohe Weihnachten!</li>
  </ul>
  <p>Am besten ihr seht euch die Seite auf dem PC an.</p>
  <p><strong>Wichtig: Alle Texte in GRO√üBUCHSTABEN eingeben</strong></p>
</div>

<!-- Seite 2: Sudoku -->
<div id="page2" class="container">
  <h2>R√§tsel 1: Weihnachtssudoku</h2>
  <p>Rufus hat ein Weihnachtssudoku versteckt (leider ist sein Bewegungsradius etwas eingeschr√§nkt).
    Alle Informationen zum L√∂sungscode sind auf dem Sudoku enthalten. Etwas Kleber wird nicht schaden üòâ</p>
</div>

<!-- Seite 3: Kreuzwortr√§tsel -->
<div id="page3" class="container">
  <h2>R√§tsel 2: Kreuzwortr√§tsel</h2>
  <p>Ich wollte es unter den Baum legen, aber leider hat es eine blaue Zau gestohlen. Ich denke sie hat das R√§tsel in ihr Lager mitgenommen.
     Die nummerierten Felder (1,2,3,4) enthalten nach dem ausf√ºllen Buchstaben, die in Alphabet-Zahlen umgewandelt werden (A=1, ..., Z=26) m√ºssen.  
     So entsteht der 4-stelliger Code.</p>
</div>

<!-- Seite 4: Hardest Game -->
<div id="page4" class="container">
  <h2>R√§tsel 3: Pro Gamer</h2>
  <p>Um an den L√∂sungscode zu kommen m√ºsst ihr das Online Spiel <a href="https://www.crazygames.com/game/worlds-hardest-game" target="_blank">World's Hardest Game</a> bis Level 8 durchspielen.  
     Z√§hlt dort:</p>
  <ol>
    <li>Anzahl blaue Punkte</li>
    <li>Anzahl gelbe Punkte</li>
    <li>Anzahl rote Vierecke</li>
    <li>Anzahl gr√ºne Vierecke</li>
  </ol>
  <p>Daraus erhaltet ihr den vierstelligen Code</p>
</div>

<!-- Seite 5: H√∂rspiel -->
<div id="page5" class="container">
  <h2>R√§tsel 4: H√∂rspiel</h2>
  <p>Wenn ihr auf play klickt h√∂rt ihr ein Lied, dass ich gesungen und produced habe. 
    Dabei habe ich 4 Ziffern in den Songtext gemixed, die irgendwo auftauchen. 
    Die Ziffern in der Reihenfolge wie sie gesungen werden ergeben den L√∂sungscode.</p>
  <div class="center">
    <audio id="audioPlayer" src="song.mp3" controls></audio>
  </div>
</div>

<!-- Seite 6: Decoder -->
<div id="decoder" class="container">
  <h2>Decoder</h2>
  <p>Hier gebt ihr die vier 4-stelligen Codes ein, plus den verschl√ºsselten Namen.  
     Wenn ihr dann "Entschl√ºsseln" dr√ºckt und alles richtig ist, sollte der lesbare Name erscheinen.</p>

  <div class="center">
    <input type="text" id="code1" class="code-input" maxlength="4" placeholder="Code1">
    <input type="text" id="code2" class="code-input" maxlength="4" placeholder="Code2">
    <input type="text" id="code3" class="code-input" maxlength="4" placeholder="Code3">
    <input type="text" id="code4" class="code-input" maxlength="4" placeholder="Code4">
    <br><br>
    <input type="text" id="encryptedName" placeholder="Verschl√ºsselter Name" style="width: 250px; padding: 5px;">
    <br>
    <button class="btn" onclick="finalDecrypt()">Entschl√ºsseln</button>
    <p id="decryptedResult"></p>
  </div>
</div>

<script>
// Einfache Seiten-Navigation
function showPage(pageId) {
  const containers = document.querySelectorAll('.container');
  containers.forEach(c => c.classList.remove('active'));
  const pageToShow = document.getElementById(pageId);
  if (pageToShow) {
    pageToShow.classList.add('active');
  }
}

// Entschl√ºsseln mit neuem Algorithmus, der alle Ziffern ber√ºcksichtigt
function finalDecrypt() {
  const code1 = document.getElementById('code1').value.trim();
  const code2 = document.getElementById('code2').value.trim();
  const code3 = document.getElementById('code3').value.trim();
  const code4 = document.getElementById('code4').value.trim();
  const encryptedText = document.getElementById('encryptedName').value.trim();

  if (!code1 || !code2 || !code3 || !code4 || !encryptedText) {
    alert("Bitte alle 4 Codes und einen verschl√ºsselten Namen eingeben!");
    return;
  }

  // Key zusammenbauen
  const key = code1 + code2 + code3 + code4; // z. B. "2344851673126921"

  // Entschl√ºsseln
  const decrypted = decryptText(encryptedText.toUpperCase(), key);
  document.getElementById('decryptedResult').textContent = "Ergebnis: " + decrypted;
}

/**
 * Entschl√ºsseln nach dem Prinzip:
 *  1) Summiere alle Ziffern im Key => totalShift (mod 26)
 *  2) F√ºr den i-ten Buchstaben => shift = (totalShift + i) mod 26
 *  3) newChar = (cipher[i] - shift) (Wrap-around von A-Z)
 */
function decryptText(cipher, key) {
  let result = "";
  
  // 1) Summe aller Ziffern => totalShift
  let totalShift = 0;
  for (let i = 0; i < key.length; i++) {
    totalShift += parseInt(key[i], 10) || 0;
  }
  totalShift = totalShift % 26; // Basis-Shift

  // 2) F√ºr jeden Buchstaben
  for (let i = 0; i < cipher.length; i++) {
    const c = cipher.charCodeAt(i);
    if (c >= 65 && c <= 90) { // A-Z
      const shiftForThisChar = (totalShift + i) % 26;
      let newChar = c - shiftForThisChar;
      if (newChar < 65) {
        newChar += 26; // Wrap-around
      }
      result += String.fromCharCode(newChar);
    } else {
      // Nicht-A-Z: unver√§ndert
      result += cipher[i];
    }
  }
  return result;
}
</script>

</body>
</html>
